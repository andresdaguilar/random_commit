name: Random Daily Commits

on:
  schedule:
    # Ejecuta cada hora para tener suficientes oportunidades
    - cron: '0 * * * *'

jobs:
  random-commit:
    runs-on: ubuntu-latest
    
    # Usamos una matriz para controlar el número aleatorio de ejecuciones
    strategy:
      matrix:
        # Genera 10 posibles ejecuciones diarias
        attempt: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
    
    steps:
      # Solo ejecuta si es un intento válido según el número aleatorio
      - name: Check if should run
        run: |
          # Genera número aleatorio entre 5 y 10 para el día
          DAILY_COMMITS=$((RANDOM % 6 + 5))
          # Solo continua si el número de intento es menor o igual al número de commits deseado
          if [ ${{ matrix.attempt }} -le $DAILY_COMMITS ]; then
            echo "Proceeding with commit attempt ${{ matrix.attempt }}"
          else
            echo "Skipping attempt ${{ matrix.attempt }}"
            exit 0
          fi

      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          ref: dev
          # Usa un token con permisos para push
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Setup git config
        run: |
          git config user.name "${{ github.actor }}"
          git config user.email "${{ github.actor }}@users.noreply.github.com"
      - name: Add text line and commit
        run: |
          # Archivo donde se añadirá la línea
          FILE="random_text_file.txt"
          # Genera una línea con timestamp
          echo "Automated commit at $(date -u '+%Y-%m-%d %H:%M:%S UTC')" >> $FILE
          
          # Forza el commit incluso si no hay cambios significativos
          git add $FILE
          git commit -m "Automated commit: Added new line to $FILE" --allow-empty || true
          
          # Forza el push al branch dev
          git push origin dev --force

      # Manejo de errores
      - name: Handle errors
        if: failure()
        run: |
          echo "Error occurred, but continuing due to force commit requirement"
          exit 0
